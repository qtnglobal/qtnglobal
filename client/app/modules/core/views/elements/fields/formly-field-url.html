<div class="form-group col-md-4" ng-class="{'has-error': options.formField.$invalid}">
  <label for="{{id}}">
    {{options.label || 'Text'}}
    {{options.required ? '*' : ''}}
  </label>
  <textarea type="text"
            class="form-control msd-elastic previewUrl"
            id="{{id}}"
            formly-dynamic-name="options.key"
            formly-custom-validation="options.validators"
            rows="{{options.lines}}"
            placeholder="{{options.placeholder}}"
            aria-describedby="{{id}}_description"
            ng-required="options.required"
            ng-disabled="options.disabled"
            ng-model="result[options.key || index]">
  </textarea>
  <p id="{{id}}_description" class="help-block" ng-if="options.description">{{options.description}}</p>
</div>

<div class="col-md-12" style="">
  <div class="liveurl-loader"></div>
  <div class="liveurl">
    <div class="close" title="Entfernen"></div>
    <div class="inner">
      <div class="image" id="liveurl-img"></div>
      <div class="details">
        <div class="info">
          <div class="title" id="liveurl-title"></div>
          <div class="description" id="liveurl-description"></div>
          <a href="#" class="url" id="liveurl-url" target="_blank"> </a>
          <div class="url" id="liveurl-url"></div>
        </div>
        <div class="thumbnail">
          <div class="pictures">
            <div class="controls">
              <div class="prev button inactive"></div>
              <div class="next button inactive"></div>
              <div class="count">
                <span class="current">0</span><span> von </span><span class="max">0</span>
              </div>
            </div>
          </div>
        </div>
        <div class="video"></div>
      </div>
    </div>
  </div>
</div>

<script>
  var curImages = new Array();
  $('.previewUrl').liveUrl({
    loadStart : function(){
      $('.liveurl-loader').show();
    },
    loadEnd : function(){
      $('.liveurl-loader').hide();
    },
    success : function(data)
    {
      var output = $('.liveurl');
      output.find('.title').text(data.title);
      output.find('.description').text(data.description);
      output.find('.url').text(data.url);
      $(".url").attr('href',data.url);
      output.find('.image').empty();
      output.find('.close').one('click', function()
      {
        var liveUrl     = $(this).parent();
        liveUrl.hide('fast');
        liveUrl.find('.video').html('').hide();
        liveUrl.find('.image').html('');
        liveUrl.find('.controls .prev').addClass('inactive');
        liveUrl.find('.controls .next').addClass('inactive');
        liveUrl.find('.thumbnail').hide();
        liveUrl.find('.image').hide();
        $('.previewUrl').trigger('clear');
        curImages = new Array();
      });
      output.show('fast');
      if (data.video != null) {
        var ratioW        = data.video.width  /350;
        data.video.width  = 350;
        data.video.height = data.video.height / ratioW;
        var video =
          '<object width="' + data.video.width  + '" height="' + data.video.height  + '">' +
          '<param name="movie"' +
          'value="' + data.video.file  + '">' +
          '<param name="allowScriptAccess" value="always">' +
          '<embed src="' + data.video.file  + '"' +
          'type="application/x-shockwave-flash"' +
          'allowscriptaccess="always"' +
          'width="' + data.video.width  + '" height="' + data.video.height  + '">' +
          '</object>';
        output.find('.video').html(video).show();
      }
    },
    addImage : function(image)
    {
      var output  = $('.liveurl');
      var jqImage = $(image);
      jqImage.attr('alt', 'Preview');
      if ((image.width / image.height)  > 7
        ||  (image.height / image.width)  > 4 ) {
        // we dont want extra large images...
        return false;
      }
      curImages.push(jqImage.attr('src'));
      output.find('.image').append(jqImage);
      if (curImages.length == 1) {
        // first image...
      /*  output.find('.thumbnail .current').text('1');
        output.find('.thumbnail').show();*/
        output.find('.image').show();
        jqImage.addClass('active');
      }
     /* if (curImages.length == 2) {
        output.find('.controls .next').removeClass('inactive');
      }
      output.find('.thumbnail .max').text(curImages.length);*/
    }
  });
  $('.liveurl ').on('click', '.controls .button', function()
  {
    var self        = $(this);
    var liveUrl     = $(this).parents('.liveurl');
    var content     = liveUrl.find('.image');
    var images      = $('img', content);
    var activeImage = $('img.active', content);
    if (self.hasClass('next'))
      var elem = activeImage.next("img");
    else var elem = activeImage.prev("img");
    if (elem.length > 0) {
      activeImage.removeClass('active');
      elem.addClass('active');
      liveUrl.find('.thumbnail .current').text(elem.index() +1);
      if (elem.index() +1 == images.length || elem.index()+1 == 1) {
        self.addClass('inactive');
      }
    }
    if (self.hasClass('next'))
      var other = elem.prev("img");
    else var other = elem.next("img");
    if (other.length > 0) {
      if (self.hasClass('next'))
        self.prev().removeClass('inactive');
      else   self.next().removeClass('inactive');
    } else {
      if (self.hasClass('next'))
        self.prev().addClass('inactive');
      else   self.next().addClass('inactive');
    }
  });
</script>
